<?php
$action_name = $_["name"]."_actions";
$action_dir = $_["action"];
//If an action is choosen
if(isset($_["id"])){
	$selected_db = new Entity($object_name."_actions",Variable::actions_fields());
	$selected = $selected_db->getById($_["id"]);
	$selected = Variable::action_args($selected);
	$form_name = "ID:".$_["id"];
	$hidden_input = [
	"type" => "hidden",
	"value" => $_["id"]
	];
}
else{
	$selected = false;
	$form_name = "New";
}

include(CORE_VIEWS."menu/available_actions.view");

$form = new Form($form_name);
	include(CORE_VIEWS."forms/form_default.view");
	if(file_exists(USER_OBJECTS.$object_name."/"."gpios")){
	include(CORE_VIEWS."forms/form_gpio.view");
	}

//Custom Fields
$form_file_dir = USER_OBJECTS.$object_name."/"."actions/".$action_dir."/form";
if(file_exists($form_file_dir)){
$inputs_file = Functions::getdir(USER_OBJECTS.$object_name."/"."actions/".$action_dir."/form");

foreach($inputs_file as $input_file){
	$file = USER_OBJECTS.$object_name."/"."actions/".$action_dir."/form/".$input_file;
	$input = Variable::md2var($file);
	
	$input["selected"] = $selected[$input["id"]];
	if(isset($input["options"])){
		$data_file = Variable::data_dir($input["options"]);
		//var_dump($data_file);
		include($data_file);
		$input["options"] = $data;
		unset($data);
	}

	$form->input($input);
	$table_headers[] = $input["name"];
	$table_datas[] = $input["id"];
}

}

	include(CORE_VIEWS."forms/form_group.view");
$form->display($tpl);

include(CORE_VIEWS."datatable/dbtable_actions.view");


?>

