<?php
//Add all languages files
$objects_dir = Functions::getdir(USER_OBJECTS);
$lang_view = "";
foreach($objects_dir as $object_dir){
	$lang_object = add_language(USER_OBJECTS.$object_dir);
	if(is_array($lang) && is_array($lang_view)){
				$lang = array_merge($lang,$lang_view); //Merge General translation with user view translation
				if(isset($lang_object)){
					if(is_array($lang_object))
						$lang = array_merge($lang,$lang_object);
				}
			}
		}

//If an object is selected
if(isset($_["id"])){
	$selected_db = new Entity("Scenario");
	$selected = $selected_db->getById($_["id"]);
	$form_name = "ID:".$_["id"];
	$hidden_input = [
	"type" => "hidden",
	"value" => $_["id"]
	];
	$selected_groups["action"] = $selected["action_tag"];
	$selected_groups["object"] = $selected["object"];
}
else
{
	$form_name = "Scenario";
	$selected=false;
	$selected_groups = false;
}
$form = new Form($form_name);

$tpl->draw(CORE_VIEWS."grids/container/bordered_open");


//Name/Description
include(CORE_VIEWS."forms/form_default.view");

//Triggers
$data_file = Variable::data_dir("triggers");
include($data_file);

$form->input([
	"type" => "select",
	"id" => "id_trigger",
	"name" => "Triggers",
	"options" => $data,
	"selected" => $selected["id_trigger"]
	]);


//Actions
$list_all_objects = True;
include(CORE_DATA."object.data");
$object_data = $data;

include(CORE_DATA."url/commands.data");
$action_data = $data;

$form->input([
			"type" => "hidden",
			"id" => "nb_actions",
			"value" => 0
			]);

$form->input([
			"type" => "chainedselect_actions",
			"objects" => $object_data,
			"options" => $action_data,
			"selected" => $selected_groups,
			"nb" => 0,
			"nowait" => True
			]);

$form->display($tpl);

$object_name = "Scenario";
if($objects){
include(CORE_VIEWS."/"."datatable/dbtable_scenario.view");
}



?>